{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\ClassManager\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\ClassManager\\src\\views\\tasks\\MyTasks.vue?vue&type=style&index=0&id=491953fa&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\ClassManager\\src\\views\\tasks\\MyTasks.vue","mtime":1600263559827},{"path":"C:\\Users\\Administrator\\Desktop\\ClassManager\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\ClassManager\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\ClassManager\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\ClassManager\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\ClassManager\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\ClassManager\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmVsLXRhYmxlIHRoLmd1dHRlciB7DQogICAgZGlzcGxheTogdGFibGUtY2VsbCAhaW1wb3J0YW50Ow0KfQ0KLmluZm9UYWJsZV9ib3ggew0KICAgIG1hcmdpbjogYXV0bzsNCiAgICB3aWR0aDogNjUwcHg7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KLmxpbmUgew0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCi5idG5zIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogZmxleC1lbmQ7DQp9DQouZXhwYW5kVGl0bGUgew0KICAgIGxldHRlci1zcGFjaW5nOiAzcHg7DQp9DQo="},{"version":3,"sources":["MyTasks.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MyTasks.vue","sourceRoot":"src/views/tasks","sourcesContent":["<template>\r\n    <div class=\"padding_limit\">\r\n        <!-- 面包屑导航 -->\r\n        <el-breadcrumb>\r\n            <el-breadcrumb-item :to=\"{ path: '/tasklaunch' }\">我的发布</el-breadcrumb-item>\r\n            <el-breadcrumb-item>任务列表</el-breadcrumb-item>\r\n        </el-breadcrumb>\r\n\r\n        <!-- 发布任务对话框 -->\r\n        <div>\r\n            <el-dialog width=\"600px\" title=\"发布任务\" :visible.sync=\"addTaskDialogVisible\">\r\n                <el-form \r\n                    ref=\"addTaskFormRef\" \r\n                    :rules=\"taskFormRuls\" \r\n                    label-width=\"100px\" \r\n                    :model=\"addTaskForm\"\r\n                    >\r\n                    <!-- 活动名称填写 -->\r\n                    <el-form-item prop=\"name\" label=\"活动任务\">\r\n                        <el-input v-model=\"addTaskForm.name\"></el-input>\r\n                    </el-form-item>\r\n                    <!-- 选择时间 -->\r\n                    <el-form-item prop=\"time\" label=\"时间范围\">\r\n                        <el-row>\r\n                            <el-col>\r\n                                <el-date-picker\r\n                                    type=\"daterange\"\r\n                                    unlink-panels\r\n                                    start-placeholder=\"开始日期\"\r\n                                    end-placeholder=\"结束日期\"\r\n                                    placeholder=\"请选择/输入日期\"\r\n                                    format=\"yyyy 年 MM 月 dd 日\"\r\n                                    value-format=\"yyyy-MM-dd\"\r\n                                    v-model=\"addTaskForm.time\"\r\n                                ></el-date-picker>\r\n                            </el-col>\r\n                        </el-row>\r\n                    </el-form-item>\r\n                    <!-- 选择命名模板 -->\r\n                    <el-form-item prop=\"format\" label=\"文件名格式\">\r\n                        <el-select\r\n                            v-model=\"addTaskForm.format\"\r\n                            placeholder=\"请慎重选择，发布后不支持修改此选项\"\r\n                            style=\"width: 85%;\"\r\n                        >\r\n                            <el-option\r\n                                v-for=\"item in options\"\r\n                                :key=\"item.label\"\r\n                                :label=\"item.label\"\r\n                                v-model=\"item.value\"\r\n                            ></el-option>\r\n                        </el-select>\r\n                    </el-form-item>\r\n                    <!-- 按钮 -->\r\n                    <el-form-item class=\"btns\">\r\n                        <el-button @click=\"handleAddTaskSubmit\" type=\"primary\">发布</el-button>\r\n                        <el-button @click=\"changeAddTaskDialog\" type=\"info\">取消</el-button>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </el-dialog>\r\n        </div>\r\n\r\n        <!-- 修改任务对话框 -->\r\n        <div>\r\n            <el-dialog width=\"600px\" title=\"修改任务\" :visible.sync=\"editTaskDialogVisible\">\r\n                <el-form ref=\"editFormRef\" :rules=\"taskFormRuls\" label-width=\"100px\" v-model=\"editTaskForm\">\r\n                    <el-form-item label=\"活动任务\">\r\n                        <el-input disabled v-model=\"editTaskForm.name\"></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item prop=\"time\" label=\"开始时间\">\r\n                        <el-row>\r\n                            <el-col>\r\n                                <el-date-picker\r\n                                    type=\"daterange\"\r\n                                    unlink-panels\r\n                                    start-placeholder=\"开始日期\"\r\n                                    end-placeholder=\"结束日期\"\r\n                                    placeholder=\"请选择/输入日期\"\r\n                                    format=\"yyyy 年 MM 月 dd 日\"\r\n                                    value-format=\"yyyy-MM-dd\"\r\n                                    v-model=\"editTaskForm.time\"\r\n                                ></el-date-picker>\r\n                            </el-col>\r\n                        </el-row>\r\n                    </el-form-item>\r\n                    <!-- 选择命名模板 -->\r\n                    <el-form-item label=\"文件名格式\">\r\n                        <el-select disabled\r\n                            v-model=\"editTaskForm.format.label\"\r\n                            style=\"width: 85%;\"\r\n                            >\r\n                        </el-select>\r\n                    </el-form-item>\r\n                    <!-- 按钮 -->\r\n                    <el-form-item class=\"btns\">\r\n                        <el-button @click=\"handleEditTaskSubmit()\" type=\"primary\">修改</el-button>\r\n                        <el-button\r\n                            @click=\"editTaskDialogVisible = !editTaskDialogVisible;\"\r\n                            type=\"info\"\r\n                        >取消</el-button>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </el-dialog>\r\n        </div>\r\n\r\n        <!-- 卡片视图 -->\r\n        <el-card>\r\n            <!-- 搜索与添加区域 -->\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"13\">\r\n                    <el-input placeholder=\"请输入搜索的内容\">\r\n                        <el-button @click=\"$message.info('该功能未开通')\" slot=\"append\" icon=\"el-icon-search\"></el-button>\r\n                    </el-input>\r\n                </el-col>\r\n                <el-col :span=\"4\">\r\n                    <el-button @click=\"changeAddTaskDialog\" type=\"primary\">发布任务</el-button>\r\n                </el-col>\r\n            </el-row>\r\n            <!-- 任务表格 -->\r\n            <el-table\r\n                :data=\"tasklist\"\r\n                border\r\n                stripe\r\n                @expand-change=\"expandSelect\"\r\n                :row-key=\"getRowKeys\"\r\n                :expand-row-keys=\"expandList\"\r\n            >\r\n                <!-- 展开栏 -->\r\n                <el-table-column type=\"expand\" align=\"center\" label=\"详情\" :resizable=\"false\">\r\n                    <template v-slot=\"scope1\">\r\n                        <div class=\"infoTable_box\">\r\n                            <p class=\"expandTitle\">未提交名单</p>\r\n                            <el-table :data=\"unDoPeop\" width=\"500px\">\r\n                                <el-table-column align=\"center\" type=\"index\" label></el-table-column>\r\n                                <el-table-column align=\"center\" prop=\"studentNumber\" label=\"学号/证件号\"></el-table-column>\r\n                                <el-table-column align=\"center\" prop=\"name\" label=\"姓名\"></el-table-column>\r\n                            </el-table>\r\n                            <p class=\"expandTitle\" style=\"margin-top: 12px\">已提交名单</p>\r\n                            <el-table :data=\"DonePeop\" width=\"500px\">\r\n                                <el-table-column align=\"center\" type=\"index\" label></el-table-column>\r\n                                <el-table-column align=\"center\" prop=\"studentNumber\" label=\"学号/证件号\"></el-table-column>\r\n                                <el-table-column align=\"center\" prop=\"name\" label=\"姓名\"></el-table-column>\r\n                                <el-table-column align=\"center\" label=\"操作\">\r\n                                    <template v-slot=\"scope2\">\r\n                                        <el-button\r\n                                            @click=\"downloadById(scope1.row.taskId, scope2.row.userId)\"\r\n                                            type=\"warning\"\r\n                                            icon=\"el-icon-download\"\r\n                                        >下载附件</el-button>\r\n                                    </template>\r\n                                </el-table-column>\r\n                            </el-table>\r\n                        </div>\r\n                    </template>\r\n                </el-table-column>\r\n                <!-- 编号 -->\r\n                <el-table-column align=\"center\" type=\"index\" label=\"编号\" :resizable=\"false\"></el-table-column>\r\n                <!-- 名称 -->\r\n                <el-table-column align=\"center\" prop=\"taskName\" label=\"名称\" :resizable=\"false\"></el-table-column>\r\n                <!-- 开始时间 -->\r\n                <el-table-column align=\"center\" label=\"开始时间\" :resizable=\"false\">\r\n                    <template v-slot:default=\"scope\">\r\n                        <i class=\"el-icon-time\"></i>\r\n                        <span style=\"margin-left: 10px;\">{{dataToNormalFormat(scope.row.taskBeginTime)}}</span>\r\n                    </template>\r\n                </el-table-column>\r\n                <!-- 结束时间 -->\r\n                <el-table-column align=\"center\" label=\"结束时间\" :resizable=\"false\">\r\n                    <template v-slot:default=\"scope\">\r\n                        <i class=\"el-icon-time\"></i>\r\n                        <span style=\"margin-left: 10px;\">{{dataToNormalFormat(scope.row.taskEndTime)}}</span>\r\n                    </template>\r\n                </el-table-column>\r\n                <!-- 完成情况 -->\r\n                <el-table-column align=\"center\" label=\"完成情况（未提交名单见详情）\" :resizable=\"false\">\r\n                    <template v-slot:default=\"scope\">\r\n                        <i\r\n                            v-if=\"scope.row.undoIds.length == 0\"\r\n                            class=\"el-icon-circle-check\"\r\n                            style=\"color: green; font-size: 15px;\"\r\n                        >已完成</i>\r\n                        <span\r\n                            v-else\r\n                        >{{scope.row.doneIds.length}} / {{scope.row.undoIds.length + scope.row.doneIds.length}}</span>\r\n                    </template>\r\n                </el-table-column>\r\n                <!-- 操作 -->\r\n                <el-table-column align=\"center\" label=\"操作 (编辑|删除|下载)\" :resizable=\"false\">\r\n                    <template v-slot:default=\"scope\">\r\n                        <div>\r\n                            <el-button\r\n                                @click=\"changeEditTaskDialog(scope)\"\r\n                                type=\"primary\"\r\n                                icon=\"el-icon-edit\"\r\n                            ></el-button>\r\n                            <el-button\r\n                                @click=\"removeById(scope.row.taskId)\"\r\n                                type=\"danger\"\r\n                                icon=\"el-icon-delete\"\r\n                            ></el-button>\r\n                            <el-button @click=\"downloadAll(scope.row.taskId)\" type=\"warning\" icon=\"el-icon-download\"></el-button>\r\n                        </div>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n        </el-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport fileDownload from 'js-file-download';\r\nexport default {\r\n    data() {\r\n        return {\r\n            // 展开行id\r\n            expandList: [],\r\n            // 获取当前行id\r\n            getRowKeys(row) {\r\n                return row.taskId;\r\n            },\r\n            // 该scope.row.id任务未完成任务人员名单\r\n            unDoPeop: [\r\n                // {\r\n                //     userId: \"1L\",\r\n                //     studentNumber: \"1812001000\",\r\n                //     name: \"张三\",\r\n                //     classroom: \"1\",\r\n                //     institude: \"Software\",\r\n                //     major: \"C.S.\",\r\n                //     grade: \"2018\",\r\n                //     school: \"JIT\",\r\n                // },\r\n            ],\r\n            // 该scope.row.id任务已完成任务人员名单\r\n            DonePeop: [\r\n                // {\r\n                //     userId: \"1L\",\r\n                //     studentNumber: \"1812001000\",\r\n                //     name: \"李四\",\r\n                //     classroom: \"1\",\r\n                //     institude: \"Software\",\r\n                //     major: \"C.S.\",\r\n                //     grade: \"2018\",\r\n                //     school: \"JIT\",\r\n                // },\r\n            ],\r\n            // 任务列表\r\n            tasklist: [\r\n                // {\r\n                //     taskId: 1,\r\n                //     luncherId: 2,\r\n                //     taskBeginTime: \"2020_09_06_20_20\",\r\n                //     taskEndTime: \"2020_09_13_20_20\",\r\n                //     undoIds: [1, 4],\r\n                //     doneIds: [2, 3, 5, 6, 7, 8],\r\n                //     taskName: \"班级文档管理接口文档\",\r\n                //     taskFileDirectory: \"\",\r\n                //     taskFileTemplate: \"/home/file/template/qwer.txt\",\r\n                //     taskFileSample: \"/home/file/sample/asdf.txt\",\r\n                //     format: \"&*#\",\r\n                // },\r\n                // {\r\n                //     taskId: 2,\r\n                //     luncherId: 2,\r\n                //     taskBeginTime: \"2020_09_06_20_20\",\r\n                //     taskEndTime: \"2020_09_12_20_20\",\r\n                //     undoIds: [],\r\n                //     doneIds: [1, 2, 3, 4, 5, 6, 7, 8],\r\n                //     taskName: \"班级文档管理接口文档\",\r\n                //     taskFileDirectory: \"\",\r\n                //     taskFileTemplate: \"/home/file/template/qwer.txt\",\r\n                //     taskFileSample: \"/home/file/sample/asdf.txt\",\r\n                //     format: \"*&#\",\r\n                // },\r\n            ],\r\n            // 查询参数\r\n            queryInfo: {\r\n                query: \"\",\r\n                pagenum: 1,\r\n                pagesize: 10,\r\n            },\r\n            // 控制添加任务对话框显示\r\n            addTaskDialogVisible: false,\r\n            // 控制编辑任务对话框显示\r\n            editTaskDialogVisible: false,\r\n            // 添加任务表单\r\n            addTaskForm: {\r\n                name: \"\",\r\n                time: [],\r\n                format: \"\",\r\n            },\r\n            // 编辑任务表单\r\n            editTaskForm: {\r\n                taskId: \"\",\r\n                name: \"\",\r\n                time: [],\r\n                format: {\r\n                    label: '',\r\n                    value: '',\r\n                },\r\n            },\r\n            // 命名格式\r\n            options: [\r\n                {\r\n                    label: \"任务名--学号--姓名\",\r\n                    value: '#*&',\r\n                },\r\n                {\r\n                    label: \"任务名--姓名--学号\",\r\n                    value: '#&*',\r\n                },\r\n                {\r\n                    label: \"学号--姓名--任务名\",\r\n                    value: '*&#',\r\n                },\r\n                {\r\n                    label: \"姓名--学号--任务名\",\r\n                    value: '&*#',\r\n                },\r\n                {\r\n                    label: \"姓名--学号\",\r\n                    value: '&*',\r\n                },\r\n                {\r\n                    label: \"学号--姓名\",\r\n                    value: '*&',\r\n                },\r\n                {\r\n                    label: \"姓名\",\r\n                    value: '&',\r\n                },\r\n                {\r\n                    label: \"学号\",\r\n                    value: '*',\r\n                },\r\n            ],\r\n            // 添加、修改表单验证规则\r\n            taskFormRuls: {\r\n                name: [\r\n                    { required: true, message: \"请输入名称\", trigger: \"blur\", },\r\n                ],\r\n                time: [\r\n                    { required: true, message: \"请选择任务时间\", trigger: \"blur\", },\r\n                ],\r\n                format: [\r\n                    { required: true, message: \"请选择命名格式\", trigger: \"blur\", },\r\n                ]\r\n            },\r\n        };\r\n    },\r\n    async created() {\r\n        this.getTasksList();\r\n    },\r\n    methods: {\r\n        // 折叠面板每次只能展开一行,同时控制未完成、已完成的名单\r\n        async expandSelect(row, expandedRows) {\r\n            let flag = false;\r\n            var that = this;\r\n            if (expandedRows.length) {\r\n                that.expandList = [];\r\n                if (row) {\r\n                    that.expandList.push(row.taskId);\r\n                }\r\n            } else {\r\n                that.expandList = [];\r\n            }\r\n            let tmpunDoPeop = [];\r\n            let tmpDonePeop = [];\r\n            for(let i = 0; i < row.undoIds.length; ++i) {\r\n                let params = new URLSearchParams();\r\n                params.append('userId', row.undoIds[i])\r\n                let user = await this.$http.post('/user/toStudent', params);\r\n                console.log(user);\r\n                if(user.data.code != 200) flag = true;\r\n                else tmpunDoPeop.push(user.data.data);\r\n            }\r\n            for(let i = 0; i < row.doneIds.length; ++i) {\r\n                let params = new URLSearchParams();\r\n                params.append('userId', row.doneIds[i])\r\n                const user = await this.$http.post('/user/toStudent', params)\r\n                if(user.data.code != 200) flag = true;\r\n                else tmpDonePeop.push(user.data.data);\r\n            }\r\n            if(flag)    this.$message.error('获取信息出现错误');\r\n            this.unDoPeop = tmpunDoPeop;\r\n            this.DonePeop = tmpDonePeop;\r\n        },\r\n        // 获取任务列表\r\n        async getTasksList() {\r\n            let flag = false;\r\n            const res = await this.$http.get(\"/user/userTasks\");\r\n            // console.log(res);\r\n            if(res.data.code != 200) return this.$message.error('获取任务失败');\r\n            // 循环遍历 获取用户发布任务的详细信息\r\n            for(let i = 0; i < res.data.data.lunchedTasks.length; ++i) {\r\n                let params = new URLSearchParams();\r\n                params.append('taskId', res.data.data.lunchedTasks[i])\r\n                // console.log(res.data.data.lunchedTasks[i]);\r\n                const task = await this.$http.post('/user/taskIdToTask', params);\r\n                // console.log(task);\r\n                if(task.data.code != 200)   flag = true;\r\n                else this.tasklist.push(task.data.data);\r\n                if(!this.tasklist[i].doneIds)   this.tasklist[i].doneIds = [];\r\n                if(!this.tasklist[i].undoIds)   this.tasklist[i].undoIds = [];\r\n                // console.log(this.tasklist[i])\r\n            }\r\n            if(flag)    this.$message.error('获取任务列表出现一些问题');\r\n        },\r\n        // 根据任务id删除任务\r\n        removeById(id) {\r\n            // 弹框询问是否确认删除\r\n            this.$confirm(\"此操作将永久删除该任务, 是否继续?\", \"提示\", {\r\n                confirmButtonText: \"确定\",\r\n                cancelButtonText: \"取消\",\r\n                type: \"warning\",\r\n            }).then(async res1 => {\r\n                // console.log(res);\r\n                let params = new URLSearchParams();\r\n                params.append('taskId', id)\r\n                const res2 = await this.$http.post('/task/delete', params);\r\n                if(res2.data.code != 200) return this.$message.error('删除失败');\r\n                this.$message.success('删除成功');\r\n                location.reload();\r\n            }).catch(error => {\r\n                \r\n            })\r\n            \r\n        },\r\n        // 改变添加任务对话框状态\r\n        changeAddTaskDialog() {\r\n            this.addTaskDialogVisible = !this.addTaskDialogVisible;\r\n        },\r\n        // 改变编辑任务对话框状态\r\n        changeEditTaskDialog(scope) {\r\n            console.log(scope);\r\n            this.editTaskForm.taskId = scope.row.taskId;\r\n            this.editTaskForm.name = scope.row.taskName;\r\n            let tmptime = [];\r\n            tmptime[0] = this.dataToNormalFormat(scope.row.taskBeginTime);\r\n            tmptime[1] = this.dataToNormalFormat(scope.row.taskEndTime);\r\n            this.editTaskForm.time = tmptime;\r\n            let tmp = {\r\n                '*': '学号',\r\n                '&': '姓名',\r\n                '#': '任务名',\r\n            }\r\n            let strtmp = tmp[scope.row.format[0]];\r\n            for(let i = 1; i < scope.row.format.length; ++i) {\r\n                strtmp = strtmp + '--' + tmp[scope.row.format[i]];\r\n            }\r\n            // console.log(strtmp);\r\n            this.editTaskForm.format.label = strtmp;\r\n            this.editTaskForm.format.value = scope.row.format;\r\n            // console.log(this.editTaskForm.format)\r\n            this.editTaskDialogVisible = !this.editTaskDialogVisible;\r\n        },\r\n        // 增加任务\r\n        handleAddTaskSubmit() {\r\n            this.$refs.addTaskFormRef.validate(async valid => {\r\n                console.log(this.addTaskForm.format);\r\n                // console.log(valid);\r\n                if(!valid)  {\r\n                    return this.$message.error(\"格式不合法\");\r\n                }\r\n                let params = new URLSearchParams();\r\n                params.append('taskName', this.addTaskForm.name);\r\n                params.append('format', this.addTaskForm.format);\r\n                params.append('taskBeginTime', this.dataToUploadFormat(this.addTaskForm.time[0]));\r\n                params.append('taskEndTime', this.dataToUploadFormat(this.addTaskForm.time[1]));\r\n                const res = await this.$http.post('/task/launch', params);\r\n                // console.log(res);\r\n                if(res.data.code != 200) return this.$message.error('添加任务失败');\r\n                this.$message.success('任务添加成功');\r\n                this.changeAddTaskDialog();\r\n                location.reload();\r\n            })\r\n        },\r\n        // 修改任务\r\n        async handleEditTaskSubmit() {\r\n            // console.log(this.editTaskForm.taskId);\r\n            let params = new URLSearchParams();\r\n            params.append('taskId', this.editTaskForm.taskId);\r\n            params.append('taskBeginTime', this.dataToUploadFormat(this.editTaskForm.time[0]));\r\n            params.append('taskEndTime', this.dataToUploadFormat(this.editTaskForm.time[1]));\r\n            const res = await this.$http.post(\"/task/update\", params);\r\n            if(res.data.code != 200) return this.$message.error('修改出错');\r\n            this.$message.success('修改成功');\r\n            location.reload();\r\n        },\r\n        // 控制日期格式输出\r\n        dataToNormalFormat(data) {\r\n            return data.substr(0, 4) + '-' + data.substr(5, 2) + '-' + data.substr(8, 2);\r\n        },\r\n        // 控制日期上传格式\r\n        dataToUploadFormat(data) {\r\n            return data.substr(0, 4) + '_' + data.substr(5, 2) + '_' + data.substr(8, 2) + '_00_00';\r\n        },\r\n        // 打包下载全部文件\r\n        async downloadAll(taskId) {\r\n            let params = new URLSearchParams();\r\n            params.append('taskId', taskId);\r\n            // params.append('userId', userId);\r\n            const resp = await this.$http.post('/file/download/msg', params);\r\n            // console.log(resp);\r\n            let filename = resp.data.data;\r\n            this.$http.post('/file/package/download', params, {responseType: 'arraybuffer'}).then(res => {\r\n                console.log(res);\r\n                fileDownload(res.data, 'files.zip');\r\n            })\r\n        },\r\n        // 下载单人文件\r\n        async downloadById(taskId, userId) {\r\n            let params = new URLSearchParams();\r\n            params.append(\"taskId\", taskId);\r\n            params.append('userId', userId);\r\n            const res = await this.$http.post(\"/file/download\", params);\r\n            // console.log(res);\r\n            const uuid = res.data.data;\r\n            let a = document.createElement(\"a\");\r\n            a.href =\r\n                `${this.$store.state.downloadURL}` +\r\n                uuid;\r\n            console.log(a.href);\r\n            document.body.appendChild(a);\r\n            a.click(); //下载\r\n            URL.revokeObjectURL(a.href); // 释放URL 对象\r\n            document.body.removeChild(a); // 删除 a 标签\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.el-table th.gutter {\r\n    display: table-cell !important;\r\n}\r\n.infoTable_box {\r\n    margin: auto;\r\n    width: 650px;\r\n    text-align: center;\r\n}\r\n.line {\r\n    text-align: center;\r\n}\r\n.btns {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n}\r\n.expandTitle {\r\n    letter-spacing: 3px;\r\n}\r\n</style>"]}]}