{"remainingRequest":"D:\\classmanagersys2\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\classmanagersys2\\src\\views\\tasks\\FinishedTasks.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\classmanagersys2\\src\\views\\tasks\\FinishedTasks.vue","mtime":1599969230696},{"path":"D:\\classmanagersys2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\classmanagersys2\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\classmanagersys2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\classmanagersys2\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgZmlsZURvd25sb2FkIGZyb20gJ2pzLWZpbGUtZG93bmxvYWQnDQpleHBvcnQgZGVmYXVsdCB7DQogICAgZGF0YSgpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIC8vIOS7u+WKoeWIl+ihqA0KICAgICAgICAgICAgdGFza2xpc3Q6IFsNCiAgICAgICAgICAgICAgICAvLyB7DQogICAgICAgICAgICAgICAgLy8gICAgIHRhc2tJZDogMSwNCiAgICAgICAgICAgICAgICAvLyAgICAgbHVuY2hlcklkOiAyLA0KICAgICAgICAgICAgICAgIC8vICAgICB0YXNrQmVnaW5UaW1lOiAiMjAyMF8wOV8wNl8yMF8yMCIsDQogICAgICAgICAgICAgICAgLy8gICAgIHRhc2tFbmRUaW1lOiAiMjAyMF8wOV8xM18yMF8yMCIsDQogICAgICAgICAgICAgICAgLy8gICAgIHVuZG9JZHM6IFsxLCA0XSwNCiAgICAgICAgICAgICAgICAvLyAgICAgZG9uZUlkczogWzIsIDMsIDUsIDYsIDcsIDhdLA0KICAgICAgICAgICAgICAgIC8vICAgICB0YXNrTmFtZTogIuePree6p+aWh+aho+euoeeQhuaOpeWPo+aWh+ahoyIsDQogICAgICAgICAgICAgICAgLy8gICAgIHRhc2tGaWxlRGlyZWN0b3J5OiAiIiwNCiAgICAgICAgICAgICAgICAvLyAgICAgdGFza0ZpbGVUZW1wbGF0ZTogIi9ob21lL2ZpbGUvdGVtcGxhdGUvcXdlci50eHQiLA0KICAgICAgICAgICAgICAgIC8vICAgICB0YXNrRmlsZVNhbXBsZTogIi9ob21lL2ZpbGUvc2FtcGxlL2FzZGYudHh0IiwNCiAgICAgICAgICAgICAgICAvLyAgICAgZm9ybWF0OiAiJiojIiwNCiAgICAgICAgICAgICAgICAvLyB9LA0KICAgICAgICAgICAgICAgIC8vIHsNCiAgICAgICAgICAgICAgICAvLyAgICAgdGFza0lkOiAyLA0KICAgICAgICAgICAgICAgIC8vICAgICBsdW5jaGVySWQ6IDIsDQogICAgICAgICAgICAgICAgLy8gICAgIHRhc2tCZWdpblRpbWU6ICIyMDIwXzA5XzA2XzIwXzIwIiwNCiAgICAgICAgICAgICAgICAvLyAgICAgdGFza0VuZFRpbWU6ICIyMDIwXzA5XzEyXzIwXzIwIiwNCiAgICAgICAgICAgICAgICAvLyAgICAgdW5kb0lkczogW10sDQogICAgICAgICAgICAgICAgLy8gICAgIGRvbmVJZHM6IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4XSwNCiAgICAgICAgICAgICAgICAvLyAgICAgdGFza05hbWU6ICLpnZLlubTlpKflrabkuaAiLA0KICAgICAgICAgICAgICAgIC8vICAgICB0YXNrRmlsZURpcmVjdG9yeTogIiIsDQogICAgICAgICAgICAgICAgLy8gICAgIHRhc2tGaWxlVGVtcGxhdGU6ICIvaG9tZS9maWxlL3RlbXBsYXRlL3F3ZXIudHh0IiwNCiAgICAgICAgICAgICAgICAvLyAgICAgdGFza0ZpbGVTYW1wbGU6ICIvaG9tZS9maWxlL3NhbXBsZS9hc2RmLnR4dCIsDQogICAgICAgICAgICAgICAgLy8gICAgIGZvcm1hdDogIiomIyIsDQogICAgICAgICAgICAgICAgLy8gfSwNCiAgICAgICAgICAgIF0sDQogICAgICAgICAgICAvLyDor7fmsYLlpLR0b2tlbg0KICAgICAgICAgICAgaGVhZGVyOiB7DQogICAgICAgICAgICAgICAgdG9rZW46IHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgLy8g5LiK5Lyg5Zyw5Z2ADQogICAgICAgICAgICB1cGxvYWRVUkw6ICdodHRwOi8vYXBpLmppdGNsYXNzLmNuL2ZpbGUvdXBsb2FkJw0KICAgICAgICB9Ow0KICAgIH0sDQogICAgY3JlYXRlZCgpIHsNCiAgICAgICAgdGhpcy5nZXRUYXNrc0xpc3QoKTsNCiAgICB9LA0KICAgIG1ldGhvZHM6IHsNCiAgICAgICAgLy8g6I635Y+W5Lu75Yqh5YiX6KGoDQogICAgICAgIGFzeW5jIGdldFRhc2tzTGlzdCgpIHsNCiAgICAgICAgICAgIGxldCBmbGFnID0gZmFsc2U7DQogICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRodHRwLmdldCgiL3VzZXIvdXNlclRhc2tzIik7DQogICAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSAhPSAyMDApIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCLojrflj5bku7vliqHlpLHotKUiKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7DQogICAgICAgICAgICAvLyDlvqrnjq/pgY3ljoYg6I635Y+W55So5oi35Y+R5biD5Lu75Yqh55qE6K+m57uG5L+h5oGvDQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlcy5kYXRhLmRhdGEuZG9uZVRhc2tzLmxlbmd0aDsgKytpKSB7DQogICAgICAgICAgICAgICAgbGV0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTsNCiAgICAgICAgICAgICAgICBwYXJhbXMuYXBwZW5kKCd0YXNrSWQnLCByZXMuZGF0YS5kYXRhLmRvbmVUYXNrc1tpXSkNCiAgICAgICAgICAgICAgICBjb25zdCB0YXNrID0gYXdhaXQgdGhpcy4kaHR0cC5wb3N0KCIvdXNlci90YXNrSWRUb1Rhc2siLCBwYXJhbXMpOw0KICAgICAgICAgICAgICAgIGlmICh0YXNrLmRhdGEuY29kZSAhPSAyMDApIGZsYWcgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHRoaXMudGFza2xpc3QucHVzaCh0YXNrLmRhdGEuZGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZmxhZykgdGhpcy4kbWVzc2FnZS5lcnJvcigi6I635Y+W5Lu75Yqh5YiX6KGo5Ye6546w5LiA5Lqb6Zeu6aKYIik7DQogICAgICAgIH0sDQogICAgICAgIC8vIOaOp+WItuaXpeacn+agvOW8j+i+k+WHug0KICAgICAgICBkYXRhVG9Ob3JtYWxGb3JtYXQoZGF0YSkgew0KICAgICAgICAgICAgcmV0dXJuICgNCiAgICAgICAgICAgICAgICBkYXRhLnN1YnN0cigwLCA0KSArDQogICAgICAgICAgICAgICAgIi0iICsNCiAgICAgICAgICAgICAgICBkYXRhLnN1YnN0cig1LCAyKSArDQogICAgICAgICAgICAgICAgIi0iICsNCiAgICAgICAgICAgICAgICBkYXRhLnN1YnN0cig4LCAyKQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgfSwNCiAgICAgICAgLy8g5LiL6L295paH5Lu2DQogICAgICAgIGFzeW5jIGRvd25sb2FkQnlJZChpZCkgew0KICAgICAgICAgICAgbGV0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTsNCiAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoJ3Rhc2tJZCcsIGlkKTsNCiAgICAgICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCB0aGlzLiRodHRwLnBvc3QoJy9maWxlL2Rvd25sb2FkL21zZycsIHBhcmFtcyk7DQogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwKTsNCiAgICAgICAgICAgIGxldCBmaWxlbmFtZSA9IHJlc3AuZGF0YS5kYXRhOw0KICAgICAgICAgICAgdGhpcy4kaHR0cC5wb3N0KCcvZmlsZS9kb3dubG9hZCcsIHBhcmFtcywge3Jlc3BvbnNlVHlwZTogJ2FycmF5YnVmZmVyJ30pLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpOw0KICAgICAgICAgICAgICAgIGZpbGVEb3dubG9hZChyZXMuZGF0YSwgZmlsZW5hbWUpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSwNCiAgICAgICAgLy8g5Yi35paw6aG16Z2iDQogICAgICAgIHJlbG9hZCgpIHsNCiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOw0KICAgICAgICB9LA0KICAgIH0sDQp9Ow0K"},{"version":3,"sources":["FinishedTasks.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FinishedTasks.vue","sourceRoot":"src/views/tasks","sourcesContent":["<template>\r\n    <div>\r\n        <!-- 面包屑导航 -->\r\n        <el-breadcrumb>\r\n            <el-breadcrumb-item :to=\"{ path: '/taskfinished' }\">已完成</el-breadcrumb-item>\r\n            <el-breadcrumb-item>任务列表</el-breadcrumb-item>\r\n        </el-breadcrumb>\r\n        <!-- 卡片视图 -->\r\n        <el-card>\r\n            <!-- 搜索与添加区域 -->\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"13\">\r\n                    <el-input placeholder=\"请输入搜索的内容\">\r\n                        <el-button\r\n                            @click=\"$message.info('该功能未开通')\"\r\n                            slot=\"append\"\r\n                            icon=\"el-icon-search\"\r\n                        ></el-button>\r\n                    </el-input>\r\n                </el-col>\r\n            </el-row>\r\n            <!-- 任务表格 -->\r\n            <el-table :data=\"tasklist\" border stripe>\r\n                <!-- 编号 -->\r\n                <el-table-column align=\"center\" type=\"index\" label=\"编号\" :resizable=\"false\"></el-table-column>\r\n                <!-- 名称 -->\r\n                <el-table-column align=\"center\" prop=\"taskName\" label=\"名称\" :resizable=\"false\"></el-table-column>\r\n                <!-- 开始时间 -->\r\n                <el-table-column align=\"center\" label=\"开始时间\" :resizable=\"false\">\r\n                    <template v-slot:default=\"scope\">\r\n                        <i class=\"el-icon-time\"></i>\r\n                        <span\r\n                            style=\"margin-left: 10px;\"\r\n                        >{{dataToNormalFormat(scope.row.taskBeginTime)}}</span>\r\n                    </template>\r\n                </el-table-column>\r\n                <!-- 结束时间 -->\r\n                <el-table-column align=\"center\" label=\"结束时间\" :resizable=\"false\">\r\n                    <template v-slot:default=\"scope\">\r\n                        <i class=\"el-icon-time\"></i>\r\n                        <span\r\n                            style=\"margin-left: 10px;\"\r\n                        >{{dataToNormalFormat(scope.row.taskEndTime)}}</span>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column align=\"center\" label=\"操作\" :resizable=\"false\">\r\n                    <template v-slot=\"scope\">\r\n                        <el-button\r\n                            @click=\"downloadById(scope.row.taskId)\"\r\n                            icon=\"el-icon-download\"\r\n                            type=\"primary\"\r\n                        >下载</el-button>\r\n                        <!-- 上传 -->\r\n                        <el-upload\r\n                            class=\"upload\"\r\n                            :headers=\"header\"\r\n                            :action=\"uploadURL\"\r\n                            :data=\"{taskId: scope.row.taskId}\"\r\n                            :on-success=\"reload\"\r\n                            :on-remove=\"reload\"\r\n                        >\r\n                            <el-button icon=\"el-icon-upload2\" type=\"info\">重新上传</el-button>\r\n                        </el-upload>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n        </el-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport fileDownload from 'js-file-download'\r\nexport default {\r\n    data() {\r\n        return {\r\n            // 任务列表\r\n            tasklist: [\r\n                // {\r\n                //     taskId: 1,\r\n                //     luncherId: 2,\r\n                //     taskBeginTime: \"2020_09_06_20_20\",\r\n                //     taskEndTime: \"2020_09_13_20_20\",\r\n                //     undoIds: [1, 4],\r\n                //     doneIds: [2, 3, 5, 6, 7, 8],\r\n                //     taskName: \"班级文档管理接口文档\",\r\n                //     taskFileDirectory: \"\",\r\n                //     taskFileTemplate: \"/home/file/template/qwer.txt\",\r\n                //     taskFileSample: \"/home/file/sample/asdf.txt\",\r\n                //     format: \"&*#\",\r\n                // },\r\n                // {\r\n                //     taskId: 2,\r\n                //     luncherId: 2,\r\n                //     taskBeginTime: \"2020_09_06_20_20\",\r\n                //     taskEndTime: \"2020_09_12_20_20\",\r\n                //     undoIds: [],\r\n                //     doneIds: [1, 2, 3, 4, 5, 6, 7, 8],\r\n                //     taskName: \"青年大学习\",\r\n                //     taskFileDirectory: \"\",\r\n                //     taskFileTemplate: \"/home/file/template/qwer.txt\",\r\n                //     taskFileSample: \"/home/file/sample/asdf.txt\",\r\n                //     format: \"*&#\",\r\n                // },\r\n            ],\r\n            // 请求头token\r\n            header: {\r\n                token: window.sessionStorage.getItem('token')\r\n            },\r\n            // 上传地址\r\n            uploadURL: 'http://api.jitclass.cn/file/upload'\r\n        };\r\n    },\r\n    created() {\r\n        this.getTasksList();\r\n    },\r\n    methods: {\r\n        // 获取任务列表\r\n        async getTasksList() {\r\n            let flag = false;\r\n            const res = await this.$http.get(\"/user/userTasks\");\r\n            if (res.data.code != 200) return this.$message.error(\"获取任务失败\");\r\n            console.log(res);\r\n            // 循环遍历 获取用户发布任务的详细信息\r\n            for (let i = 0; i < res.data.data.doneTasks.length; ++i) {\r\n                let params = new URLSearchParams();\r\n                params.append('taskId', res.data.data.doneTasks[i])\r\n                const task = await this.$http.post(\"/user/taskIdToTask\", params);\r\n                if (task.data.code != 200) flag = true;\r\n                this.tasklist.push(task.data.data);\r\n            }\r\n            if (flag) this.$message.error(\"获取任务列表出现一些问题\");\r\n        },\r\n        // 控制日期格式输出\r\n        dataToNormalFormat(data) {\r\n            return (\r\n                data.substr(0, 4) +\r\n                \"-\" +\r\n                data.substr(5, 2) +\r\n                \"-\" +\r\n                data.substr(8, 2)\r\n            );\r\n        },\r\n        // 下载文件\r\n        async downloadById(id) {\r\n            let params = new URLSearchParams();\r\n            params.append('taskId', id);\r\n            const resp = await this.$http.post('/file/download/msg', params);\r\n            // console.log(resp);\r\n            let filename = resp.data.data;\r\n            this.$http.post('/file/download', params, {responseType: 'arraybuffer'}).then(res => {\r\n                console.log(res);\r\n                fileDownload(res.data, filename);\r\n            })\r\n        },\r\n        // 刷新页面\r\n        reload() {\r\n            location.reload();\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.el-table th.gutter {\r\n    display: table-cell !important;\r\n}\r\n.infoTable_box {\r\n    margin: auto;\r\n    width: 650px;\r\n    text-align: center;\r\n}\r\n.line {\r\n    text-align: center;\r\n}\r\n.btns {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n}\r\n.expandTitle {\r\n    letter-spacing: 3px;\r\n}\r\n.upload {\r\n    display: inline-block;\r\n    margin-left: 10px;\r\n}\r\n</style>"]}]}